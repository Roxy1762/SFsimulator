# 黑箱：算法飞升 (Algorithm Ascension Game)

一款回合制策略模拟游戏，玩家扮演推荐系统的首席架构师，在资源限制下通过收集数据、训练模型、升级硬件来应对流量考核，最终训练出统治人类注意力的终极算法。

## 🎮 游戏特色

- **多维度模型指标**: 准确率、推理速度、创造力、鲁棒性四个维度的平衡发展
- **资源管理策略**: 管理资金、算力、脏数据、黄金数据等多种资源
- **风险与收益**: 平衡熵值（技术债）和法律风险，避免系统崩溃
- **初始形态选择**: 创业公司、大厂团队、学术研究三种不同的游戏体验
- **随机事件系统**: 投资人注资、服务器故障、法律罚款等突发事件
- **设备升级系统**: GPU、存储、网络、散热设备的渐进式升级

## 🚀 快速开始

### 环境要求

- Node.js >= 18.0.0
- npm >= 9.0.0

### 安装与运行

```bash
# 1. 进入项目目录
cd SFsimulator

# 2. 安装依赖
npm install

# 3. 启动开发服务器
npm run dev

# 4. 在浏览器访问
# http://localhost:5173
```

### 其他命令

```bash
# 生产构建
npm run build

# 预览生产构建
npm run preview

# 运行测试
npm run test

# 运行测试（单次）
npm run test --run

# 代码检查
npm run lint
```

## 🎯 游戏玩法

### 初始形态选择

**创业公司**
- 起始资源: 3000资金, 3算力上限
- 特殊能力: 考核奖励 +50%
- 适合: 高风险高回报的激进策略

**大厂团队**
- 起始资源: 10000资金, 5算力上限
- 特殊能力: 资源充足，稳定发展
- 适合: 稳健的长期发展策略

**学术研究**
- 起始资源: 5000资金, 4算力上限
- 特殊能力: 训练效率 +20%，数据清洗成本 -50%
- 适合: 注重技术优化的平衡策略

### 核心机制

#### 资源系统
- **资金**: 执行大部分操作的基础消耗
- **算力点数**: 每回合恢复，限制单回合操作次数
- **脏数据**: 通过爬虫等方式获取，质量较低
- **黄金数据**: 高质量数据，训练效果更好

#### 模型指标（四维平衡）
- **准确率**: 模型预测的准确程度
- **推理速度**: 模型响应速度
- **创造力**: 生成内容的多样性和创新性
- **鲁棒性**: 对抗攻击和异常输入的抵抗力

#### 风险管理
- **熵值（技术债）**: 0-40%安全，41-80%危险区，81-100%崩溃区
- **法律风险**: 使用隐私数据等操作会增加，累积过高触发罚款
- **服务熔断**: 熵值过高时有概率跳过回合并扣除维修费

#### 考核系统
- 每7回合进行一次流量洪峰考核
- 收益 = 基础流量 × 综合拟合指数 × 稳定性系数
- 稳定性系数根据熵值确定：低熵值1.2倍，高熵值0.5倍

### 操作类型

#### 数据获取
- **全网爬虫**: 低成本获取大量脏数据，增加熵值
- **数据清洗**: 将脏数据转化为黄金数据，降低熵值
- **购买隐私数据**: 直接获得黄金数据，增加法律风险
- **合作数据共享**: 安全但效率较低的数据获取方式
- **用户行为采集**: 平衡成本和风险的数据收集

#### 模型训练
- **随机梯度下降**: 基础训练，主要提升准确率
- **精细微调**: 使用黄金数据，均衡提升各项指标
- **对抗训练**: 高风险高回报，主要提升鲁棒性
- **迁移学习**: 利用预训练模型，主要提升推理速度
- **强化学习**: 通过奖励机制，主要提升创造力
- **模型蒸馏训练**: 压缩模型提升速度，牺牲创造力

#### 系统维护
- **代码重构**: 降低熵值，维护系统稳定性
- **知识蒸馏**: 清零熵值但永久降低拟合度上限
- **系统优化**: 小幅降低熵值的日常维护
- **合规审计**: 降低法律风险
- **服务器扩容**: 永久增加算力上限

### 胜利条件
- 达到足够高的综合拟合指数
- 成功应对多轮流量考核
- 避免因资金不足或系统崩溃导致的游戏失败

## 🏗️ 技术架构

### 技术栈
- **前端框架**: React 18 + TypeScript
- **状态管理**: React Context API + useReducer
- **样式方案**: CSS Modules
- **构建工具**: Vite
- **测试框架**: Vitest + fast-check (属性测试)
- **持久化**: Browser LocalStorage API

### 项目结构
```
src/
├── components/          # React 组件
│   ├── GameInitializer/ # 游戏初始化界面
│   ├── GameBoard/       # 主游戏界面
│   ├── ResourcePanel/   # 资源面板
│   ├── MetricsPanel/    # 指标面板
│   ├── OperationsPanel/ # 操作面板
│   ├── EventLog/        # 事件日志
│   └── ...
├── context/             # React Context
├── engine/              # 游戏引擎
│   ├── GameEngine.ts    # 核心游戏逻辑
│   ├── ExamSystem.ts    # 考核系统
│   └── EventSystem.ts   # 事件系统
├── operations/          # 操作定义
├── types/               # TypeScript 类型定义
└── utils/               # 工具函数
```

### 设计原则
- **不可变状态**: 所有游戏状态更新通过纯函数实现
- **单一数据源**: 游戏状态集中管理，UI从状态派生
- **关注点分离**: 业务逻辑与UI组件解耦
- **可测试性**: 核心逻辑独立于React，便于测试

## 🧪 测试

项目包含完整的测试套件：

```bash
# 运行所有测试
npm run test

# 运行单次测试（CI模式）
npm run test --run
```

### 测试覆盖
- **属性测试**: 使用fast-check验证24个核心正确性属性
- **单元测试**: 覆盖所有组件和核心逻辑
- **集成测试**: 测试完整的游戏流程

### 核心属性测试
- 资源范围不变量（拟合指数、熵值保持0-100范围）
- 操作资源验证（资源不足时操作被拒绝）
- 回合管理（算力恢复、回合计数）
- 各类操作效果验证
- 考核系统计算正确性
- 游戏状态序列化往返

## 📦 部署

### 静态托管部署

构建后的 `dist/` 目录可部署到任意静态托管服务：

- **Vercel**: 推荐，支持自动部署
- **Netlify**: 简单易用
- **GitHub Pages**: 免费托管
- **阿里云OSS**: 国内访问速度快
- **腾讯云COS**: 企业级服务

### 部署步骤

```bash
# 1. 构建生产版本
npm run build

# 2. 上传 dist/ 目录到托管服务
# 或使用各平台的CLI工具自动部署
```

### Nginx 配置示例

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/dist;
    index index.html;

    # SPA路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

## 🤝 开发指南

### 添加新操作

1. 在 `src/operations/index.ts` 中定义操作对象
2. 在 `src/engine/GameEngine.ts` 中实现操作逻辑
3. 添加对应的属性测试验证操作效果
4. 更新UI组件显示新操作

### 添加新事件

1. 在 `src/engine/EventSystem.ts` 中定义事件
2. 设置触发条件和效果
3. 在游戏引擎中集成事件触发逻辑

### 代码规范

- 使用TypeScript严格模式
- 遵循React Hooks最佳实践
- 保持组件单一职责
- 编写对应的测试用例

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🎯 路线图

- [ ] 多语言支持（英文）
- [ ] 音效和背景音乐
- [ ] 更多初始形态和操作类型
- [ ] 成就系统
- [ ] 排行榜功能
- [ ] 移动端适配优化
